server {
  listen 80;
  server_name _;

  # Proxy для микрофронтов: /mf/orders/* -> mf-orders, /mf/admin/* -> mf-admin
  location ^~ /mf/orders/ {
    proxy_pass http://mf-orders:80/;
    proxy_set_header Host $host;
    proxy_set_header X-Real-IP $remote_addr;
    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
  }

  # also allow /mf/orders (without trailing slash)
  location = /mf/orders {
    proxy_pass http://mf-orders:80/;
    proxy_set_header Host $host;
  }

  location ^~ /mf/admin/ {
    proxy_pass http://mf-admin:80/;
    proxy_set_header Host $host;
    proxy_set_header X-Real-IP $remote_addr;
    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
  }
  location = /mf/admin {
    proxy_pass http://mf-admin:80/;
    proxy_set_header Host $host;
  }

  # API proxy -> back (internal service)
  location /api/ {
    proxy_pass http://back:8000/;
    proxy_set_header Host $host;
    proxy_set_header X-Real-IP $remote_addr;
    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
  }

  # Статика shell
  location / {
    root /usr/share/nginx/html;
    index index.html;
    # SPA fallback: если файл не найден — отдать index.html (чтобы обновления /orders и /admin работали)
    try_files $uri $uri/ /index.html;
  }
}
